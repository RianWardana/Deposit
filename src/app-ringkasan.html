<link rel="import" href="ringkasan-data.html">

<dom-module id="app-ringkasan">
    <template>
        <style include="iron-flex iron-flex-alignment shared-styles">
            :host {
                display: block;
                --paper-tabs-selection-bar-color: #83ADCF; /*200*/
                --paper-tab-ink: #043F71;
            }

            app-toolbar {
                top: 64px;
                background-color: var(--app-primary-color);
                color: #fff;
            }

            paper-material {
                margin: 16px;
            }

            #inputBulan {
                background-color: #fff;
                border: 0;
                border-radius: 2px;
                font-family: 'Roboto', 'Noto', sans-serif;
                padding: 5px;
                width: 240px;
            }
        </style>

        <app-header-layout>
            <app-header slot="header">
                <app-toolbar>
                    <input type="month" id="inputBulan" min="2015-08" max="{{yearMonthMax}}" value="{{yearMonthLast}}">
                    <span class="flex"></span>
                    <paper-icon-button icon="search" on-tap="_tapSearch"></paper-icon-button>
                </app-toolbar>
            </app-header>

            <paper-material>
                <template is="dom-repeat" items="{{_toArray(pengeluaran)}}" as="item">
                    <div class="horizontal layout">
                        <span>{{item.0}}</span>
                        <span class="flex"></span>
                        <span>{{_formatJumlah(item.1)}}</span>
                    </div>
                </template>
            </paper-material>

            <paper-material>
                <div class="horizontal layout">
                    <span>Total pengeluaran</span>
                    <span class="flex"></span>
                    <span>{{_formatJumlah(total)}}</span>
                </div>
            </paper-material>
            
        </app-header-layout>
        
        <ringkasan-data pengeluaran="{{pengeluaran}}" total="{{total}}"></ringkasan-data>
    </template>



    <script>
        (function() {
            Polymer({
                is: 'app-ringkasan',
                // behaviors: [Polymer.IronResizableBehavior],
                properties: {
                    // tab_sekarang: { type: String, value: 'tagihan' },
                    // uid: String
                },

                ready: function() {
                    console.log("[READY] app-ringkasan.html");
                    thisAppRing = this;
                    var yearToday = (new Date()).getFullYear();
                    var monthToday = (new Date()).getMonth();
                    thisAppRing.yearMonthMax = new Date(yearToday, monthToday+1).toISOString().slice(0,7);
                    thisAppRing.yearMonthLast = new Date(yearToday, monthToday).toISOString().slice(0,7);
                },

                _toArray: function(object) {
                    if (Object.keys(object) < 1) return [['Pengeluaran', 0]];
                    return Object.entries(object);
                },

                _formatJumlah: function(jumlah) {
                    return 'Rp' + parseInt(jumlah).toLocaleString('id-ID')
                },

                _tapSearch: function() {
                    var year = (thisAppRing.$.inputBulan.value).slice(0,4);
                    var month = (thisAppRing.$.inputBulan.value).slice(5,7);
                    thisRingDat.loadPengeluaran(year, month-1);
                }

                // setupToolbar: function() {
                //     this.$.appHeader.style.top = '64px'
                //     that = this;
                //     window.addEventListener('scroll', function() {
                //         that.$.appHeader.style.top = (window.pageYOffset <= 64 ? (64 - window.pageYOffset) : 0) + 'px';
                //     });
                // }
            });
        })();
    </script>
</dom-module>