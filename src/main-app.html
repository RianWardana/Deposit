<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">

<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-image/iron-image.html">
<link rel="import" href="../bower_components/iron-overlay-behavior/iron-overlay-behavior.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">

<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-material/paper-material.html">
<link rel="import" href="../bower_components/paper-progress/paper-progress.html">
<link rel="import" href="../bower_components/paper-styles/typography.html">
<link rel="import" href="../bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../bower_components/paper-toggle-button/paper-toggle-button.html">

<link rel="import" href="../bower_components/neon-animation/animations/fade-in-animation.html">
<link rel="import" href="../bower_components/neon-animation/animations/fade-out-animation.html">
<link rel="import" href="../bower_components/neon-animation/animations/slide-up-animation.html">
<link rel="import" href="../bower_components/neon-animation/animations/slide-from-bottom-animation.html">
<link rel="import" href="../bower_components/neon-animation/animations/scale-up-animation.html">
<link rel="import" href="../bower_components/neon-animation/neon-animation-runner-behavior.html">
<link rel="import" href="../bower_components/neon-animation/neon-animated-pages.html">

<!-- <link rel="import" href="../bower_components/platinum-sw/platinum-sw-register.html"> -->
<!-- <link rel="import" href="../bower_components/platinum-sw/platinum-sw-cache.html"> -->

<!-- <link rel="import" href="../bower_components/iron-swipeable-pages/iron-swipeable-pages.html"> -->

<link rel="import" href="shared-styles.html">

<!-- deposit app -> * page -->
<link rel="import" href="app-auth.html">
<link rel="import" href="app-deposit.html">

<!-- deposit app -> deposit page -> * tab -->
<link rel="import" href="deposit-rekening.html">
<link rel="import" href="deposit-tagihan.html">
<link rel="import" href="deposit-tunai.html">

<!-- deposit app -> deposit page -> rekening tab -->
<link rel="import" href="rekening-data.html">
<link rel="import" href="rekening-list.html">
<link rel="import" href="rekening-item.html">
<link rel="import" href="rekening-tambah.html">

<!-- deposit app -> deposit page -> pengeluaran tab -->
<link rel="import" href="tagihan-data.html">
<link rel="import" href="tagihan-list.html">
<link rel="import" href="tagihan-item.html">
<link rel="import" href="tagihan-tambah.html">
<link rel="import" href="tagihan-edit.html">

<!-- deposit app -> deposit page -> tunai tab -->
<link rel="import" href="tunai-data.html">

<!-- deposit app -> ringkasan page -->
<link rel="import" href="app-ringkasan.html">



<dom-module id="main-app">
    <template>
        <style include="iron-flex iron-flex-alignment">
            :host {
                display: block;
                --app-primary-color: #1E88E5; /*500 065A9F*/
                --app-secondary-color: black;
            }

            app-drawer-layout:not([narrow]) [drawer-toggle] {
                display: none;
            }

            app-header {
                background-color: var(--app-primary-color);
                color: #fff;
            }

            hr {
                border: 0;
                height: 1px;
                background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15), rgba(0, 0, 0, 0));
            }

            iron-icon {
                margin-right: 12px;
            }

            iron-selector > paper-item {
                color: var(--app-primary-color);
                font-weight: 500;
                text-decoration: none;
                outline-style:none;
                box-shadow:none;
                border-color:transparent;
            }

            iron-selector > paper-item.iron-selected {
                background: #e3ecf6;
                color: var(--app-primary-color);
            }

            iron-selector > paper-item#logout {
                color: #c0392b;
                font-weight: 500;
            }
        </style>


        <neon-animated-pages selected="{{sudah_login}}" entry-animation="fade-in-animation" exit-animation="fade-out-animation">
            <app-auth login-status="{{sudah_login}}" trigger="{{triggerLogout}}"></app-auth>

            <app-drawer-layout id="appdrawerlayout" fullbleed>
                <app-drawer id="appdrawer" slot="drawer">
                    <iron-image style="width:256px; height:225px;" sizing="cover" src="../img/drawer.png"></iron-image>
                    <iron-selector attr-for-selected="halaman" selected="{{halaman_sekarang}}" on-iron-select="onMenuSelect"> <!-- saat sudah berhasil login dia tidak mau ke halaman "Deposit". Variabel {{halaman_sekarang}} iseng2 saya ganti asal. Eh bisa. saya ngga ngerti kenapa -->
                        <paper-item halaman="Deposit"><iron-icon icon="list"></iron-icon>Deposit</paper-item>
                        <paper-item halaman="Ringkasan"><iron-icon icon="timeline"></iron-icon>Ringkasan</paper-item>
                        <hr>
                        <paper-item id="logout" on-tap="_tapLogOut"><iron-icon icon="exit-to-app"></iron-icon>Log out</paper-item>
                    </iron-selector>
                </app-drawer>
            
                <app-header-layout>
                    <app-header slot="header">
                        <app-toolbar>
                            <paper-icon-button icon="menu" drawer-toggle></paper-icon-button>
                            <div main-title style="margin-left: 10px">{{halaman_sekarang}}</div>
                        </app-toolbar>
                    </app-header>
            
                    <iron-pages attr-for-selected="halaman" selected="{{halaman_sekarang}}">
                        <app-deposit halaman="Deposit"></app-deposit>
                        <!-- <div halaman="Ringkasan">Ringkasan deposit</div> -->
                        <app-ringkasan halaman="Ringkasan"></app-ringkasan>
                    </iron-pages>
            
                    <div style="height: 120px"></div>
                </app-header-layout>
            </app-drawer-layout>
        </neon-animated-pages>

        <platinum-sw-register auto-register clients-claim skip-waiting on-service-worker-installed="_swInstalled">
            <platinum-sw-cache default-cache-strategy="networkFirst">
            </platinum-sw-cache>
        </platinum-sw-register>
    
        <!-- Fail di Gulp -->
        <!-- <template is="dom-if" if="{{loadRingkasan}}">
            <link rel="import" href="src/app-ringkasan.html">
        </template> -->
    </template>
    

    <script>
        Polymer({
            is: 'main-app',
            behaviors: [Polymer.NeonAnimatableBehavior],
            properties: {
                halaman_sekarang: { 
                    type: String, 
                    value: 'Deposit',
                    observer: '_halamanChanged'
                },

                loadRingkasan: {
                    type: Boolean,
                    value: false
                },

                isRingkasanLoaded: {
                    type: Boolean,
                    value: false
                },
                
                triggerLogout: {
                    type: Number
                }
            },

            ready: function() {
                thisMainApp = this;
                console.log("[READY] main-app.html")

                // auth.onAuthStateChanged(firebaseUser => {
                //     if (firebaseUser) {
                //         this.halaman_sekarang = "Deposit"
                //     }
                // })
            },

            _halamanChanged: function() {
                if (this.halaman_sekarang == 'Ringkasan') {
                    if (!this.isRingkasanLoaded) {
                        this.loadRingkasan = true;
                        this.isRingkasanLoaded = true;
                    }
                }
            },

            _tapLogOut: function() {
                this.triggerLogout = Math.random()
            },

            _swInstalled: function() {
                console.log("SW Installed")
            },

            onMenuSelect: function() {
                if (this.$.appdrawerlayout.narrow) 
                    this.$.appdrawer.close();
            }
        });
    </script>
</dom-module>
