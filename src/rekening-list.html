<dom-module id="rekening-list">
    <template>
        <style include="iron-flex iron-flex-alignment shared-styles">
            paper-material#paper-material-saldo {
                margin-top: 32px;
                margin-bottom: 32px;
                background: var(--app-primary-color);
                color: white;
            }

            paper-spinner {
                --paper-spinner-layer-1-color: #FF9800;
                --paper-spinner-layer-2-color: #1E88E5;
                --paper-spinner-layer-3-color: #FF9800;
                --paper-spinner-layer-4-color: #1E88E5;
                position: fixed;
                padding-top: calc(50vh - 120px);
                /*z-index: 999;*/
            }
        </style>
        
        <div class="horizontal layout center-justified">
            <paper-spinner id="spinner" active></paper-spinner>
        </div>

        <div id="list">
            <paper-material id="paper-material-saldo">
                <div class="horizontal layout">
                    <span>Saldo di rekening</span>
                    <span class="flex"></span>
                    <span><b>Rp{{formatSaldo(saldo)}}</b></span>
                </div>
            </paper-material>
            
            <template is="dom-repeat" items="{{data}}" as="item">
                <rekening-item 
                    waktu="{{item.waktu}}"
                    nama="{{item.nama}}" 
                    jumlah="{{item.jumlah}}"
                    jenis="{{item.jenis}}" >
                </rekening-item>
            </template>
        </div>
    </template>

    <script>
        (function() {
            Polymer({
                is: 'rekening-list',
                // behaviors: [Polymer.NeonAnimationRunnerBehavior],
                properties: {
                    data: { 
                        type: Object,
                        notify: true,
                        observer: '_dataChanged'
                    },

                    // persistedData: { 
                    //     type: Object,
                    //     notify: true,
                    //     observer: '_dataChanged'
                    // },

                    saldo: {
                        type: Number,
                        value: 0
                    },

                    daftarHari: {
                        type: Array,
                        value: [
                            'Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'
                        ]
                    },

                    daftarBulan: {
                        type: Array,
                        value: [
                            'Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'
                        ]
                    },

                    // animationConfig: {
                    //     value: function() {
                    //         return {
                    //             'exitSpinner': [
                    //                 {
                    //                     name: 'fade-out-animation',
                    //                     node: this.$.spinner,
                    //                     timing: {delay: 100, duration: 200}
                    //                 },
                    //                 {
                    //                     name: 'slide-up-animation',
                    //                     node: this.$.spinner,
                    //                     timing: {duration: 800}
                    //                 }
                    //             ],
                    //             'entryList': [
                    //                 {
                    //                     name: 'fade-in-animation',
                    //                     node: this.$.list,
                    //                     timing: {delay: 500, duration: 500}
                    //                 },
                    //                 {
                    //                     name: 'slide-from-bottom-animation',
                    //                     node: this.$.list,
                    //                     timing: {duration: 1000}
                    //                 }
                    //             ]
                    //         }
                    //     }
                    // }
                },

                listeners: {
                    // 'neon-animation-finish': '_animationFinished'
                },

                ready: function() {
                    dataChangedCount = 0
                    animationFinishedCount = 0

                    auth.onAuthStateChanged(firebaseUser => {
                        if (firebaseUser) {
                            dataChangedCount = 0
                            animationFinishedCount = 0
                            this.$.spinner.style.display = 'block'
                            this.$.list.style.display = 'none'  
                        }
                        else {
                            dataChangedCount = -1
                        }
                    })
                },

                _dataChanged: function() {
                    console.log("_dataChanged number " + dataChangedCount + " is called.")
                    // this.playAnimation('exitSpinner')
                    this.$.list.style.display = 'block'
                    // this.playAnimation('entryList')
                    dataChangedCount++
                },

                _animationFinished: function() {
                    if (animationFinishedCount == 0) {
                        this.$.spinner.style.display = 'none'
                        // this.$.list.style.display = 'block'
                        // this.playAnimation('entryList')
                        animationFinishedCount++
                    }
                },

                formatSaldo: function(dataSaldo) {
                    if (isNaN(dataSaldo)) return 0;
                    else return parseInt(dataSaldo).toLocaleString('id-ID');
                }

            });
        })();
    </script>
</dom-module>